Purity checking
===============
This page is about checking the "purity" (read: absence of links to ApplicationServices, CoreServices and other proprietary, closed-source frameworks and libraries).
<div class="sites-embed-align-left-wrapping-off">
<div class="sites-embed-border-off sites-embed" style="width:250px;">
<div class="sites-embed-content sites-embed-type-toc">
<div class="goog-toc sites-embed-toc-maxdepth-6">

Contents

 *  [**1** About "purity"](#about-purity)
 *  [**2** Script](#script)
 *  [**3** Blacklist](#blacklist)
 *  [**4** Results](#results)

### About "purity"

Since the proprietary, closed-source frameworks and libraries that are part of Mac OS X but not Darwin, we must ensure that none of the binaries generated through the MacPorts project link to any of them.

What additionally complicates the matter is that links are "inherited" in the Darwin linker system. Say, <span style="font-style:italic">liba</span> links to ApplicationServices by mistake, <span style="font-style:italic">libb</span> links to <span style="font-style:italic">liba</span>, and <span style="font-style:italic">libc</span> links to <span style="font-style:italic">libb</span>. In this case, even <span style="font-style:italic">libc</span> now has the "wrong" link to ApplicationServices, even though <span style="font-style:italic">libc</span> itself wouldn't need it.

[![](https://raw.github.com/wiki/PureDarwin/PureDarwin/images/libalibblibc.png)](purity/libalibblibc.png%3Fattredirects=0)

Typically ApplicationServices will not show up in Makefile.in, but configure will put it into the autogenerated Makefile in these cases.

So it is really crucial to check that no unneccessary links are introduced into the system, as they propagate all the way up through the stack.

### Script

The script at the bottom of this page will help you checking the "purity" of a given RPM package <span style="color:rgb(255,0,0)">(todo: include this in MacPorts before/after building the RPM...)<span style="color:rgb(0,0,0)">.</span></span>
<span style="color:rgb(255,0,0)"><span style="color:rgb(0,0,0)">Also, take a look at [Visualize dependencies in MacPorts page](macports-dependencies-overview.html) if you want to check (and have an overview) of the "purity" of all dependencies (installed ports) for a given portname.</span></span>
    Alternatively, you can use something like this to see impurities as they happen during the build process:sh-3.2# port clean cairo
    --->  Cleaning cairo
    sh-3.2# port -v -d build cairo +puredarwin 2>&1 | grep Services
    checking ApplicationServices/ApplicationServices.h usability... yes
    checking ApplicationServices/ApplicationServices.h presence... yes
    checking for ApplicationServices/ApplicationServices.h... yesAnother check is grep -R Services /opt/local/lib/pkgconfig/otool -L /opt/local/lib/*.dylib | grep ServicesWhich should not return anything like ApplicationServices and the like.

### Blacklist

The following are proprietary, closed-source frameworks and libraries that we must not link to if we want to deploy some binary packages generated through MacPorts to PureDarwin.
-   AppKit
-   ApplicationServices
-   Carbon
-   Cocoa
-   CoreFoundation (if CF-Lite is insufficient, which needs to be tested manually)
-   CoreServices
-   Symbolication
-   ...

### Results

Some results of the example shown above
-   Terminal links to ApplicationServices
-   Thunar links to ApplicationServices and CoreServices
-   Xft2 links to ApplicationServices
-   cairo links to ApplicationServices and CoreServices
-   exo links to ApplicationServices
-   fontconfig links to ApplicationServices
-   glib2 links to Carbon
-   gettext links to CoreFoundation
-   libglade2 links to ApplicationServices
-   libxfcegui4 links to ApplicationServices and CoreServices
-   mousepad links to ApplicationServices
-   orage links to ApplicationServices
-   pango links to AppKit, ApplicationServices, Carbon, Cocoa, CoreFoundation, Foundation
-   popt links to CoreFoundation
-   python25 links to AppKit, ApplicationServices, Carbon, CoreFoundation, CoreServices, Foundation, QuickTime
-   xfdesktop links to ApplicationServices, CoreServices
-   xfprint links to ApplicationServices, CoreFoundation, CoreServices
-   xfwm4 links to ApplicationServices, CoreServices

